<div class="admins-page-container">
  <!-- Main Content -->
  <div class="main-content">
    <div class="admin-list-page">
      <!-- Title -->
      <div class="page-title-bar">
        <h1 class="page-title">Admins List</h1>
        <button *ngIf="roleLoaded && canManage" class="add-admin-btn" (click)="openCreateModal()">
          <i class="fas fa-plus"></i> Add New Admin
        </button>
      </div>

      <!-- Top Stats Cards -->
      <div class="top-cards-container">
        <div class="top-card light-purple">
          <h3>Total Admins</h3>
          <p>{{ admins.length }}</p>
        </div>
        <div class="top-card light-green">
          <h3>Active Admins</h3>
          <p>{{ countActive() }}</p>
        </div>
        <div class="top-card light-gray">
          <h3>Inactive Admins</h3>
          <p>{{ countInactive() }}</p>
        </div>
      </div>

      <!-- Search and Filters -->
      <div class="controls-container">
        <div class="search-container">
          <input 
            type="text" 
            [(ngModel)]="searchTerm" 
            placeholder="Search by name, email, or phone..." 
            class="search-input" 
            (input)="forceUpdate()"
          />
          <i class="fa fa-search search-icon"></i>
        </div>

        <div class="filter-controls">
          <select [(ngModel)]="selectedStatus" class="filter-select" (change)="forceUpdate()">
            <option value="">All Status</option>
            <option value="Active">Active</option>
            <option value="Inactive">Inactive</option>
          </select>

          <button (click)="sortByName()" class="sort-btn">
            <i class="fa fa-sort-alpha-down"></i> Sort by Name
          </button>

          <button (click)="sortByStatus()" class="sort-btn">
            <i class="fa fa-sort"></i> Sort by Status
          </button>

          <button (click)="clearAllFilters()" class="clear-all-btn">
            <i class="fas fa-times-circle"></i> Clear Filters
          </button>
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading && admins.length === 0" class="loading-container">
        <div class="loading-spinner">
          <i class="fas fa-spinner fa-spin fa-3x"></i>
          <p>Loading admins...</p>
        </div>
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMessage && !isLoading" class="error-message">
        <i class="fas fa-exclamation-circle"></i>
        {{ errorMessage }}
        <button (click)="loadAdmins()" class="btn btn-retry" style="margin-left: 10px;">
          <i class="fas fa-redo"></i> Retry
        </button>
      </div>

      <!-- Results Bar -->
      <div class="results-bar" *ngIf="!isLoading && admins.length > 0">
        <div class="results-info">
          <i class="fas fa-user-shield"></i>
          Showing <span class="highlight">{{filteredAdmins().length}}</span> of 
          <span class="total">{{admins.length}}</span> admins
        </div>
      </div>
      
      <!-- Empty State -->
      <div *ngIf="!isLoading && admins.length === 0" class="empty-state">
        <div class="empty-state-content">
          <i class="fas fa-user-shield fa-4x"></i>
          <h2>No Admins Found</h2>
          <p>There are no admins in the system yet.</p>
          <button *ngIf="canManage" class="add-admin-btn" (click)="openCreateModal()">
            <i class="fas fa-plus"></i> Add First Admin
          </button>
        </div>
      </div>

      <!-- Admin Cards Container -->
      <div class="cards-container" *ngIf="!isLoading && admins.length > 0">
        <div
          class="admin-card"
          *ngFor="let admin of filteredAdmins(); let i = index"
          [style.background-color]="getCardColor(i)"
        >
          <div class="admin-photo-wrapper">
            <img 
              [src]="admin.profileImage || 'assets/images/admin-placeholder.png'" 
              [alt]="admin.fullName" 
              class="admin-photo"
              (error)="$event.target.src='assets/images/admin-placeholder.png'"
            />
            <div class="status-badge" [class.active]="admin.isActive">
              <i [class]="admin.isActive ? 'fas fa-circle-check' : 'fas fa-circle-xmark'"></i>
              {{ admin.isActive ? 'Active' : 'Inactive' }}
            </div>
          </div>
          
          <div class="admin-info">
            <h3>{{ admin.fullName }}</h3>
            <p class="admin-id"><i class="fa fa-id-badge"></i> ID: {{ admin.id }}</p>
            <p class="admin-email">
              <i class="fa fa-envelope"></i> {{ admin.email }}
            </p>
            <p class="admin-phone" *ngIf="admin.mobilePhone">
              <i class="fa fa-phone"></i> {{ admin.mobilePhone }}
            </p>
            <div class="admin-details">
              <p *ngIf="admin.gender">
                <i [class]="getGenderIcon(admin.gender)"></i> {{ admin.gender }}
              </p>
              <p *ngIf="admin.mitrialStatus">
                <i class="fas fa-heart"></i> {{ admin.mitrialStatus }}
              </p>
              <p *ngIf="admin.age">
                <i class="fas fa-birthday-cake"></i> {{ admin.age }} years
              </p>
            </div>
            <p class="member-since" *ngIf="admin.createDate">
              <i class="fas fa-calendar-plus"></i> Member since {{ (admin.createDate | date: 'mediumDate') }}
            </p>
          </div>

          <div class="admin-actions">
            <button class="view-btn" [routerLink]="['/admins', admin.id]">
              <i class="fas fa-eye"></i> View Profile
            </button>
            <!-- Edit button - only if admin can edit (their own profile) -->
            <button *ngIf="roleLoaded && canEdit(admin.id)" class="edit-btn" (click)="openEditModal(admin)">
              <i class="fas fa-edit"></i> Edit
            </button>
            <!-- Activate/Deactivate button - admins can manage other admins -->
            <button *ngIf="roleLoaded && canManage" class="activate-btn" [ngClass]="{ active: admin.isActive }" (click)="toggleActive(admin)">
              <i [class]="admin.isActive ? 'fas fa-user-slash' : 'fas fa-user-check'"></i>
              {{ admin.isActive ? 'Deactivate' : 'Activate' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin Form Modal -->
  <app-admin-form-modal
    [isVisible]="showAdminModal"
    [isEditMode]="isEditMode"
    [selectedAdmin]="selectedAdmin"
    [isLoading]="isLoading"
    (close)="closeModal()"
    (save)="onSaveAdmin($event)"
  >
  </app-admin-form-modal>

  <!-- Confirmation Modal -->
  <app-confirmation-modal
    [isVisible]="showConfirmationModal"
    [title]="confirmationConfig.title"
    [message]="confirmationConfig.message"
    [icon]="confirmationConfig.icon"
    [iconColor]="confirmationConfig.iconColor"
    [confirmText]="confirmationConfig.confirmText"
    [cancelText]="confirmationConfig.cancelText"
    [confirmButtonClass]="confirmationConfig.confirmButtonClass"
    (confirm)="onConfirmAction()"
    (cancel)="onCancelAction()">
  </app-confirmation-modal>
</div>