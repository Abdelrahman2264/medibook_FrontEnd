<div class="doctors-page-container">
  <!-- Main Content -->
  <div class="main-content">
    <div class="doctor-list-page">
      <!-- Title -->
      <div class="page-title-bar">
        <h1 class="page-title">Doctors List</h1>
        <button *ngIf="roleLoaded && canManage" class="add-doctor-btn" (click)="openCreateModal()">
          <i class="fas fa-plus"></i> Add New Doctor
        </button>
      </div>

      <!-- Top Stats Cards -->
      <div class="top-cards-container">
        <div class="top-card light-blue">
          <h3>Total Doctors</h3>
          <p>{{ doctors.length }}</p>
        </div>
        <div class="top-card light-green">
          <h3>Active Doctors</h3>
          <p>{{ countActive() }}</p>
        </div>
        <div class="top-card light-orange">
          <h3>Inactive Doctors</h3>
          <p>{{ countInactive() }}</p>
        </div>
        <div class="top-card light-purple">
          <h3>Specialties</h3>
          <p>{{ specialties.length }}</p>
        </div>
      </div>

      <!-- Search -->
      <div class="search-container">
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          placeholder="Search by name..." 
          class="search-input" 
          (input)="forceUpdate()"
        />
        <i class="fa fa-search search-icon"></i>
      </div>

      <!-- Filters & Sort -->
      <div class="controls">
        <select [(ngModel)]="selectedSpecialty" class="filter-select" (change)="forceUpdate()">
          <option value="">Filter by Specialties</option>
          <option *ngFor="let s of specialties" [value]="s">{{ s }}</option>
        </select>

        <select [(ngModel)]="selectedState" class="filter-select" (change)="forceUpdate()">
          <option value="">Filter by State</option>
          <option *ngFor="let st of states" [value]="st">{{ st }}</option>
        </select>

        <button (click)="sortByName()" class="sort-btn">
          Sort by Name <i class="fa fa-sort-alpha-down"></i>
        </button>

        <button (click)="clearAllFilters()" class="clear-all-btn">
          Clear All <i class="fas fa-times-circle"></i>
        </button>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading && doctors.length === 0" class="loading-container">
        <div class="loading-spinner">
          <i class="fas fa-spinner fa-spin fa-3x"></i>
          <p>Loading doctors...</p>
          <div class="loading-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMessage && !isLoading" class="error-message">
        <i class="fas fa-exclamation-circle"></i>
        {{ errorMessage }}
        <button (click)="loadDoctors()" class="btn btn-retry" style="margin-left: 10px;">
          <i class="fas fa-redo"></i> Retry
        </button>
      </div>

      <!-- Results Bar -->
      <div class="results-bar" *ngIf="!isLoading && doctors.length > 0">
        <div class="results-info">
          <i class="fas fa-user-md"></i>
          Showing <span class="highlight">{{filteredDoctors().length}}</span> of 
          <span class="total">{{doctors.length}}</span> doctors
        </div>
        <div class="results-actions">
        </div>
      </div>
      
      <!-- Empty State -->
      <div *ngIf="!isLoading && doctors.length === 0" class="empty-state">
        <div class="empty-state-content">
          <i class="fas fa-user-md fa-4x"></i>
          <h2>No Doctors Found</h2>
          <p>There are no doctors in the system yet.</p>
          <button class="add-doctor-btn" (click)="openCreateModal()">
            <i class="fas fa-plus"></i> Add First Doctor
          </button>
        </div>
      </div>

      <!-- Doctor Cards Container -->
      <div class="cards-container" *ngIf="!isLoading && doctors.length > 0">
        <div
          class="doctor-card"
          *ngFor="let doctor of filteredDoctors(); let i = index"
          
        >
          <div class="doctor-photo-wrapper">
            <img 
              [src]="doctor.photoUrl || 'assets/images/doctor-placeholder.png'" 
              [alt]="doctor.fullName" 
              class="doctor-photo"
              (error)="$event.target.src='assets/images/doctor-placeholder.png'"
            />
            <div class="status-badge" [class.active]="doctor.isActive" [class.inactive]="!doctor.isActive">
              <i [class]="doctor.isActive ? 'fas fa-circle-check' : 'fas fa-circle-xmark'"></i>
              {{ doctor.isActive ? 'Active' : 'Inactive' }}
            </div>
          </div>
          
          <div class="doctor-info">
            <h3>{{ doctor.fullName || 'N/A' }}</h3>
            <p *ngIf="doctor.doctorId"><i class="fa fa-id-badge"></i> ID: {{ doctor.doctorId }}</p>
            <p *ngIf="doctor.specialization">
              <i [class]="getSpecialtyIcon(doctor.specialization)"></i> 
              Specialization: {{ doctor.specialization }}
            </p>
            <p *ngIf="doctor.type">
              <i class="fas fa-briefcase"></i> Type: {{ doctor.type }}
            </p>
            <p *ngIf="doctor.experienceYears !== undefined">
              <i class="fas fa-calendar-alt"></i> Experience: {{ doctor.experienceYears }} Years
            </p>
            <p *ngIf="doctor.email">
              <i class="fa fa-envelope"></i> {{ doctor.email }}
            </p>
            <p *ngIf="doctor.mobilePhone">
              <i class="fa fa-phone"></i> {{ doctor.mobilePhone }}
            </p>
            <p *ngIf="doctor.gender">
              <i class="fas fa-venus-mars"></i> {{ doctor.gender }}
            </p>
            <p *ngIf="doctor.bio" class="bio-preview">
              <i class="fas fa-info-circle"></i> {{ doctor.bio.length > 50 ? (doctor.bio.substring(0, 50) + '...') : doctor.bio }}
            </p>
          </div>

          <div class="doctor-actions">
            <button class="view-btn" [routerLink]="['/doctors', doctor.doctorId]">
              <i class="fas fa-eye"></i> View Profile
            </button>
            <button *ngIf="roleLoaded && canManage" class="edit-btn" (click)="openEditModal(doctor)">
              <i class="fas fa-edit"></i> Edit
            </button>
            <button *ngIf="roleLoaded && canManage" class="activate-btn" [ngClass]="{ active: doctor.isActive }" (click)="toggleActive(doctor)">
              <i [class]="doctor.isActive ? 'fas fa-user-slash' : 'fas fa-user-check'"></i>
              {{ doctor.isActive ? 'Deactivate' : 'Activate' }}
            </button>
          </div>
        </div>
      </div>

      <!-- Banner Advertisement -->
      <div class="banner-advertisement">
        <div class="banner-content">
          <div class="banner-text">
            <h2>Special Promotion!</h2>
            <p>Get exclusive access to premium features and enhance your medical practice</p>
            <div class="banner-features">
              <span><i class="fas fa-check"></i> Advanced Analytics</span>
              <span><i class="fas fa-check"></i> Priority Support</span>
              <span><i class="fas fa-check"></i> Unlimited Storage</span>
            </div>
          </div>
          <div class="banner-offer">
            <div class="offer-badge">50% OFF</div>
            <p class="offer-text">First 3 months</p>
            <button class="banner-cta">Upgrade Now</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Doctor Form Modal -->
  <app-doctor-form-modal
    [isVisible]="showDoctorModal"
    [isEditMode]="isEditMode"
    [selectedDoctor]="selectedDoctor"
    [specialties]="specialties"
    [isLoading]="isLoading"
    (close)="closeModal()"
    (save)="onSaveDoctor($event)"
  >
  </app-doctor-form-modal>

  <!-- Confirmation Modal -->
  <app-confirmation-modal
    [isVisible]="showConfirmationModal"
    [title]="confirmationConfig.title"
    [message]="confirmationConfig.message"
    [icon]="confirmationConfig.icon"
    [iconColor]="confirmationConfig.iconColor"
    [confirmText]="confirmationConfig.confirmText"
    [cancelText]="confirmationConfig.cancelText"
    [confirmButtonClass]="confirmationConfig.confirmButtonClass"
    (confirm)="onConfirmAction()"
    (cancel)="onCancelAction()">
  </app-confirmation-modal>
</div>