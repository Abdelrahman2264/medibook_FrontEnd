<div class="patients-page-container">
  <!-- Main Content -->
  <div class="main-content">
    <div class="patient-list-page">
      <!-- Title -->
      <div class="page-title-bar">
        <h1 class="page-title">Patients List</h1>
        <div class="page-actions">
          <span class="total-count">Total: {{ patients.length }} patients</span>
        </div>
      </div>

      <!-- Top Stats Cards -->
      <div class="top-cards-container">
        <div class="top-card light-blue">
          <h3>Total Patients</h3>
          <p>{{ patients.length }}</p>
        </div>
        <div class="top-card light-green">
          <h3>Active Patients</h3>
          <p>{{ countActive() }}</p>
        </div>
        <div class="top-card light-red">
          <h3>Inactive Patients</h3>
          <p>{{ countInactive() }}</p>
        </div>
      </div>

      <!-- Search and Filters -->
      <div class="controls-container">
        <div class="search-container">
          <input 
            type="text" 
            [(ngModel)]="searchTerm" 
            placeholder="Search by name, email, or phone..." 
            class="search-input" 
            (input)="forceUpdate()"
          />
          <i class="fa fa-search search-icon"></i>
        </div>

        <div class="filter-controls">
          <select [(ngModel)]="selectedStatus" class="filter-select" (change)="forceUpdate()">
            <option value="">All Status</option>
            <option value="Active">Active</option>
            <option value="Inactive">Inactive</option>
          </select>

          <button (click)="sortByName()" class="sort-btn">
            <i class="fa fa-sort-alpha-down"></i> Sort by Name
          </button>

          <button (click)="sortByStatus()" class="sort-btn">
            <i class="fa fa-sort"></i> Sort by Status
          </button>

          <button (click)="clearAllFilters()" class="clear-all-btn">
            <i class="fas fa-times-circle"></i> Clear Filters
          </button>
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading && patients.length === 0" class="loading-container">
        <div class="loading-spinner">
          <i class="fas fa-spinner fa-spin fa-3x"></i>
          <p>Loading patients...</p>
        </div>
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMessage && !isLoading" class="error-message">
        <i class="fas fa-exclamation-circle"></i>
        {{ errorMessage }}
        <button (click)="loadPatients()" class="btn btn-retry" style="margin-left: 10px;">
          <i class="fas fa-redo"></i> Retry
        </button>
      </div>

      <!-- Results Bar -->
      <div class="results-bar" *ngIf="!isLoading && patients.length > 0">
        <div class="results-info">
          <i class="fas fa-users"></i>
          Showing <span class="highlight">{{filteredPatients().length}}</span> of 
          <span class="total">{{patients.length}}</span> patients
        </div>
      </div>
      
      <!-- Empty State -->
      <div *ngIf="!isLoading && patients.length === 0" class="empty-state">
        <div class="empty-state-content">
          <i class="fas fa-user-injured fa-4x"></i>
          <h2>No Patients Found</h2>
          <p>There are no patients in the system yet.</p>
        </div>
      </div>

      <!-- Patients Table -->
      <div class="table-container" *ngIf="!isLoading && patients.length > 0">
        <table class="patients-table">
          <thead>
            <tr>
              <th>Photo</th>
              <th>Name</th>
              <th>Contact Info</th>
              <th>Personal Details</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let patient of filteredPatients()" class="patient-row">
              <td class="patient-photo">
                <img 
                  [src]="patient.profileImage || 'assets/images/patient-placeholder.png'" 
                  [alt]="patient.fullName" 
                  class="patient-image"
                  (error)="$event.target.src='assets/images/patient-placeholder.png'"
                />
              </td>
              <td class="patient-name">
                <div class="name-info">
                  <strong>{{ patient.fullName }}</strong>
                  <small>ID: {{ patient.id }}</small>
                </div>
              </td>
              <td class="contact-info">
                <div class="contact-item w-fit  mx-auto">
                  <i class="fa fa-envelope"></i>
                  {{ patient.email }}
                </div>
                <div class="contact-item w-fit mx-auto" *ngIf="patient.mobilePhone">
                  <i class="fa fa-phone"></i>
                  {{ patient.mobilePhone }}
                </div>
              </td>
              <td class="personal-info">
                <div class="info-item w-fit  mx-auto">
                  <i [class]="getGenderIcon(patient.gender)"></i>
                  {{ patient.gender || 'Not specified' }}
                </div>
                <div class="info-item w-fit  mx-auto" *ngIf="patient.age">
                  <i class="fas fa-birthday-cake"></i>
                  {{ patient.age }} years
                </div>
                <div class="info-item w-fit  mx-auto" *ngIf="patient.mitrialStatus">
                  <i class="fas fa-heart"></i>
                  {{ patient.mitrialStatus }}
                </div>
              </td>
              <td class="status-cell">
                <span [class]="getStatusBadgeClass(patient.isActive)">
                  <i [class]="patient.isActive ? 'fas fa-circle-check' : 'fas fa-circle-xmark'"></i>
                  {{ patient.isActive ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td class="actions-cell">
                <div class="action-buttons" *ngIf="roleLoaded && canManage">
                  <button class="btn-view" [routerLink]="['/patients', patient.id]">
                    <i class="fas fa-eye"></i> View
                  </button>
                  <button class="btn-edit" (click)="openEditModal(patient)">
                    <i class="fas fa-edit"></i> Edit
                  </button>
                  <button 
                    class="btn-toggle" 
                    [class.btn-activate]="!patient.isActive" 
                    [class.btn-deactivate]="patient.isActive" 
                    (click)="toggleActive(patient)"
                  >
                    <i [class]="patient.isActive ? 'fas fa-user-slash' : 'fas fa-user-check'"></i>
                    {{ patient.isActive ? 'Deactivate' : 'Activate' }}
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Patient Form Modal -->
  <app-patient-form-modal
    [isVisible]="showPatientModal"
    [isEditMode]="isEditMode"
    [selectedPatient]="selectedPatient"
    [isLoading]="isLoading"
    (close)="closeModal()"
    (save)="onSavePatient($event)"
  >
  </app-patient-form-modal>

  <!-- Confirmation Modal -->
  <app-confirmation-modal
    [isVisible]="showConfirmationModal"
    [title]="confirmationConfig.title"
    [message]="confirmationConfig.message"
    [icon]="confirmationConfig.icon"
    [iconColor]="confirmationConfig.iconColor"
    [confirmText]="confirmationConfig.confirmText"
    [cancelText]="confirmationConfig.cancelText"
    [confirmButtonClass]="confirmationConfig.confirmButtonClass"
    (confirm)="onConfirmAction()"
    (cancel)="onCancelAction()">
  </app-confirmation-modal>
</div>