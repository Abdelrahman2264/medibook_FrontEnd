<div class="patients-container">
  <!-- Statistics Cards - ÿ±ÿ¨ÿπÿ™ŸáŸÖ ŸÑŸÜŸÅÿ≥ ÿßŸÑÿßÿ≥ÿ™ÿßŸäŸÑ ÿßŸÑŸÇÿØŸäŸÖ -->
  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-info">
        <div class="stat-number">{{ allPatients.length }}</div>
        <div class="stat-label">Total Patients</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-info">
        <div class="stat-number">{{ getPatientsByStatus('In Treatment') }}</div>
        <div class="stat-label">In Treatment</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-info">
        <div class="stat-number">{{ getPatientsByStatus('Recovered') }}</div>
        <div class="stat-label">Recovered</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-info">
        <div class="stat-number">{{ getPatientsByStatus('Critical') + getPatientsByStatus('Emergency') }}</div>
        <div class="stat-label">Critical Cases</div>
      </div>
    </div>
  </div>

  <!-- Header -->
  <div class="header">
    <h1>Patients Management</h1>
    
    <div class="controls">
      <div class="search-bar">
        <div class="search-wrapper">
          <input 
            type="text" 
            placeholder="Search by name, condition, email, or date (YYYY-MM-DD)..." 
            [(ngModel)]="searchTerm"
            (input)="searchPatients()"
            (focus)="showSuggestions = true"
            (blur)="hideSuggestions()"
            (keydown.escape)="clearSearch()"
            aria-label="Search patients by name, condition, email, or date">
          
          <!-- Auto-complete Suggestions -->
          <div class="suggestions-dropdown" *ngIf="showSuggestions && searchTerm">
            <div *ngFor="let suggestion of getSearchSuggestions()" 
                 class="suggestion-item"
                 (mousedown)="selectSuggestion(suggestion)">
              <span class="suggestion-name">{{ suggestion.name }}</span>
              <span class="suggestion-details">
                {{ suggestion.condition }} ‚Ä¢ {{ suggestion.lastVisit }}
              </span>
            </div>
          </div>
        </div>
        
        <button class="filter-btn" (click)="showFilters = !showFilters"
                [attr.aria-expanded]="showFilters"
                aria-label="Toggle filters panel">
          <span>üîç Filter</span>
        </button>
        
        <div class="sort-wrapper">
          <button class="sort-btn" (click)="toggleSort()"
                  aria-label="Sort patients">
            <span> Sort</span>
          </button>
          
          <!-- Sort Options -->
          <div class="sort-options" *ngIf="showSortOptions">
            <div class="sort-option" (click)="sortPatients('name')">
              Name {{ sortField === 'name' ? (sortDirection === 'asc' ? '‚Üë' : '‚Üì') : '' }}
            </div>
            <div class="sort-option" (click)="sortPatients('age')">
              Age {{ sortField === 'age' ? (sortDirection === 'asc' ? '‚Üë' : '‚Üì') : '' }}
            </div>
            <div class="sort-option" (click)="sortPatients('condition')">
              Condition {{ sortField === 'condition' ? (sortDirection === 'asc' ? '‚Üë' : '‚Üì') : '' }}
            </div>
            <div class="sort-option" (click)="sortPatients('lastVisit')">
              Last Visit {{ sortField === 'lastVisit' ? (sortDirection === 'asc' ? '‚Üë' : '‚Üì') : '' }}
            </div>
          </div>
        </div>
      </div>
      
      <button class="add-patient-btn">
        <span>‚ûï Add New Patient</span>
      </button>
    </div>
  </div>

  <!-- ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®ÿ≠ÿ´ -->
  <div class="search-status" *ngIf="isSearching">
    <div class="loading-spinner"></div>
    üîç Searching...
  </div>

  <div class="results-count" *ngIf="!isSearching">
    Showing {{ patients.length }} of {{ allPatients.length }} patients
  </div>

  <!-- Loading Skeleton -->
  <div class="skeleton-container" *ngIf="isSearching">
    <div class="skeleton-row" *ngFor="let item of [1,2,3,4,5]">
      <div class="skeleton-avatar"></div>
      <div class="skeleton-text"></div>
      <div class="skeleton-text short"></div>
      <div class="skeleton-text"></div>
      <div class="skeleton-text short"></div>
      <div class="skeleton-badge"></div>
      <div class="skeleton-button"></div>
    </div>
  </div>

  <!-- Filters Panel -->
  <div class="filters-panel" *ngIf="showFilters">
    <div class="filter-group">
      <label>Status</label>
      <select [(ngModel)]="filters.status" (change)="applyFilters()">
        <option value="">All Status</option>
        <option *ngFor="let status of statusOptions" [value]="status">{{status}}</option>
      </select>
    </div>
    
    <div class="filter-group">
      <label>Condition Type</label>
      <select [(ngModel)]="filters.condition" (change)="applyFilters()">
        <option value="">All Conditions</option>
        <option *ngFor="let condition of conditionOptions" [value]="condition">{{condition}}</option>
      </select>
    </div>
    
    <div class="filter-group">
      <label>Age Range</label>
      <select [(ngModel)]="filters.ageRange" (change)="applyFilters()">
        <option *ngFor="let range of ageRangeOptions" [value]="range.value">{{range.label}}</option>
      </select>
    </div>
    
    <div class="filter-group">
      <label>Visit Date</label>
      <input type="date" [(ngModel)]="filters.visitDate" (change)="applyFilters()">
    </div>
    
    <div class="filter-actions">
      <button class="cancel-btn" (click)="resetFilters()">Cancel</button>
      <button class="apply-btn" (click)="applyFilters()">Apply</button>
    </div>
  </div>

  <!-- Patients Table -->
  <div class="table-container" *ngIf="!isSearching || patients.length > 0">
    <table class="patients-table">
      <thead>
        <tr>
          <th (click)="sortPatients('name')" class="sortable">
            Name {{ sortField === 'name' ? (sortDirection === 'asc' ? '‚Üë' : '‚Üì') : '' }}
          </th>
          <th (click)="sortPatients('age')" class="sortable">
            Age {{ sortField === 'age' ? (sortDirection === 'asc' ? '‚Üë' : '‚Üì') : '' }}
          </th>
          <th (click)="sortPatients('condition')" class="sortable">
            Condition {{ sortField === 'condition' ? (sortDirection === 'asc' ? '‚Üë' : '‚Üì') : '' }}
          </th>
          <th (click)="sortPatients('lastVisit')" class="sortable">
            Last Visit {{ sortField === 'lastVisit' ? (sortDirection === 'asc' ? '‚Üë' : '‚Üì') : '' }}
          </th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let patient of patients" class="patient-row">
          <td>
            <div class="patient-info">
              <div class="patient-photo">
                <div class="avatar-placeholder">{{ patient.name.charAt(0) }}</div>
              </div>
              <div class="patient-details">
                <div class="patient-name">{{ patient.name }}</div>
                <div class="patient-email">{{ patient.email }}</div>
              </div>
            </div>
          </td>
          <td>
            <span class="age-badge">{{ patient.age }}</span>
          </td>
          <td>{{ patient.condition }}</td>
          <td>
            <span class="visit-date">{{ patient.lastVisit }}</span>
          </td>
          <td>
            <span [class]="'status ' + patient.status.toLowerCase().replace(' ', '-')">
              {{ patient.status }}
            </span>
          </td>
          <td>
            <button class="view-details-btn" (click)="viewPatientDetails(patient)"
                    aria-label="View details for {{ patient.name }}">
              View Details
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="patients.length === 0 && !isSearching">
      <div class="empty-icon">üë•</div>
      <h3>No patients found</h3>
      <p>Try adjusting your search criteria or filters</p>
      <button class="reset-btn" (click)="resetFilters()">Reset All Filters</button>
    </div>
  </div>

  <!-- Patient Details Modal -->
  <div class="patient-modal-overlay" *ngIf="showPatientDetails" (click)="closePatientDetails()">
    <div class="patient-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Patient Details</h2>
        <!-- ÿ±ÿ¨ÿπÿ™ ÿπŸÑÿßŸÖÿ© ÿßŸÑÿßŸÉÿ≥ ÿ≤Ÿä ŸÖÿß ŸÉÿßŸÜÿ™ -->
        <button class="close-btn" (click)="closePatientDetails()" aria-label="Close patient details">√ó</button>
      </div>
      
      <div class="modal-content" *ngIf="selectedPatient">
        <!-- Patient Photo and Basic Info -->
        <div class="patient-header">
          <div class="patient-avatar-large">
            <div class="avatar-placeholder-large">{{ selectedPatient.name.charAt(0) }}</div>
          </div>
          <div class="patient-basic-info">
            <h3>{{ selectedPatient.name }}</h3>
            <div class="patient-status-large">
              <span [class]="'status ' + selectedPatient.status.toLowerCase().replace(' ', '-')">
                {{ selectedPatient.status }}
              </span>
            </div>
            <div class="patient-id">Patient ID: #{{ selectedPatient.id }}</div>
          </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="modal-tabs">
          <button class="tab-btn" 
                  [class.active]="activeTab === 'info'"
                  (click)="activeTab = 'info'">
             Basic Info
          </button>
          <button class="tab-btn" 
                  [class.active]="activeTab === 'medical'"
                  (click)="activeTab = 'medical'">
             Medical History
          </button>
          <button class="tab-btn" 
                  [class.active]="activeTab === 'treatment'"
                  (click)="activeTab = 'treatment'">
             Treatment Plan
          </button>
          <button class="tab-btn" 
                  [class.active]="activeTab === 'documents'"
                  (click)="activeTab = 'documents'">
            üìÑ Documents
          </button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
          <!-- Basic Info Tab -->
          <div *ngIf="activeTab === 'info'" class="tab-pane">
            <div class="info-grid">
              <div class="info-section">
                <h4>Personal Information</h4>
                <div class="info-row">
                  <span class="info-label">Age:</span>
                  <span class="info-value">{{ selectedPatient.age }} years</span>
                </div>
                <div class="info-row">
                  <span class="info-label">Email:</span>
                  <span class="info-value">{{ selectedPatient.email }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">Phone:</span>
                  <span class="info-value">{{ selectedPatient.phone }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">Last Visit:</span>
                  <span class="info-value">{{ selectedPatient.lastVisit }}</span>
                </div>
              </div>

              <div class="info-section">
                <h4>Medical Information</h4>
                <div class="info-row">
                  <span class="info-label">Condition:</span>
                  <span class="info-value">{{ selectedPatient.condition }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">Treatment Plan:</span>
                  <span class="info-value">{{ getTreatmentPlan(selectedPatient.condition) }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">Current Status:</span>
                  <span class="info-value">{{ selectedPatient.status }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Medical History Tab -->
          <div *ngIf="activeTab === 'medical'" class="tab-pane">
            <div class="medical-history">
              <h4>Medical History Timeline</h4>
              <div class="history-timeline">
                <div class="history-item" *ngFor="let record of getMedicalHistory(selectedPatient.id)">
                  <div class="history-date">{{ record.date }}</div>
                  <div class="history-content">
                    <strong>{{ record.type }}</strong>
                    <p>{{ record.description }}</p>
                    <span class="history-doctor">Dr. {{ record.doctor }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Treatment Plan Tab -->
          <div *ngIf="activeTab === 'treatment'" class="tab-pane">
            <div class="treatment-plan">
              <h4>Current Treatment Plan</h4>
              <div class="treatment-list">
                <div class="treatment-item" *ngFor="let treatment of getTreatmentDetails(selectedPatient.condition)">
                  <div class="treatment-info">
                    <strong>{{ treatment.medication }}</strong>
                    <p class="treatment-dosage">{{ treatment.dosage }}</p>
                    <small class="treatment-schedule">{{ treatment.schedule }}</small>
                  </div>
                </div>
              </div>
              
              <div class="treatment-notes">
                <h5>Additional Notes</h5>
                <p>{{ getTreatmentPlan(selectedPatient.condition) }}</p>
              </div>
            </div>
          </div>

          <!-- Documents Tab -->
          <div *ngIf="activeTab === 'documents'" class="tab-pane">
            <div class="documents-section">
              <h4>Patient Documents</h4>
              <div class="documents-list">
                <div class="document-item" *ngFor="let doc of getPatientDocuments(selectedPatient.id)">
                  <div class="doc-info">
                    <strong>{{ doc.name }}</strong>
                    <p>Uploaded: {{ doc.date }}</p>
                  </div>
                  <button class="download-btn" aria-label="Download {{ doc.name }}">‚¨áÔ∏è</button>
                </div>
              </div>
              
              <div class="upload-section">
                <h5>Upload New Document</h5>
                <div class="upload-area">
                  <span class="upload-icon">üì§</span>
                  <p>Drag & drop files here or click to browse</p>
                  <button class="upload-btn">Browse Files</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="modal-actions">
          <button class="btn-secondary" (click)="closePatientDetails()">Close</button>
          <button class="btn-primary">Edit Patient</button>
          <button class="btn-danger">Generate Report</button>
        </div>
      </div>
    </div>
  </div>
</div>